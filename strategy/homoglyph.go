// Licensed to Typogenerator under one or more contributor
// license agreements. See the NOTICE file distributed with
// this work for additional information regarding copyright
// ownership. Typogenerator licenses this file to you under
// the Apache License, Version 2.0 (the "License"); you may
// not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.

package strategy

import (
	"fmt"

	"zntr.io/typogenerator/helpers"
)

var Homoglyph Strategy

type homoglyphStrategy struct {
}

// -----------------------------------------------------------------------------

func (s *homoglyphStrategy) Generate(domain, tld string) ([]string, error) {
	res := []string{}
	// `á…Ÿá… â€€â€â€‚â€ƒâ€„â€…â€†â€‡â€ˆã€€ã…¤Çƒï¼×´â€³ï¼‚ï¼„ï¼…ï¼†ï¼‡ï¹ï¼ˆï¹ï¼‰âï¼Šï¼‹â€šï¼Œâ€ğ†‘ï¼Ù Û”ÜÜ‚â€¤â€§ã€‚ï¼ï½¡â„âˆ•â•±â«»â«½ï¼ï¾‰ÎŸÎ¿ĞĞ¾Õ•ğ’†ï¼¯ï½ÎŸÎ¿ĞĞ¾Õ•ğ’†ï¼¯ï½Ø§
	// ï¼‘ï¼’ï¼“ï¼”ï¼•ï¼–ğ’‡ï¼—Õ‘ï¼˜ï¼™Ö‰ÜƒÜ„âˆ¶ê‰ï¼šÍ¾ï¼›â€¹ï¼œğ†ï¼â€ºï¼ï¼Ÿï¼ ï¼»ï¼¼ï¼½ï¼¾ï¼¿ï½€
	// Ã€ÃÃ‚ÃƒÃ„Ã…Ã Ã¡Ã¢Ã£Ã¤Ã¥É‘Î‘Î±Ğ°áªï¼¡ï½ÃŸÊ™Î’Î²Ğ’Ğ¬á´á›’ï¼¢ï½‚Ï²Ï¹Ğ¡ÑáŸâ…­â…½ğ’¨ï¼£ï½ƒÄÄÄÄ‘ÔÕªá â…®â…¾ï¼¤ï½„ÃˆÃ‰ÃŠÃ‹Ã©ÃªÃ«Ä’Ä“Ä”Ä•Ä–Ä—Ä˜ÄšÄ›Î•Ğ•Ğµá¬ï¼¥ï½…Ïœï¼¦ï½†É¡É¢ÔŒÕ¶á€ï¼§ï½‡ÊœÎ—ĞÒ»á»ï¼¨ï½ˆÉ©Î™Ğ†Ñ–Ø§á¥á›â… â…°ğ’ƒï¼©ï½‰Ï³ĞˆÑ˜Õµá«ï¼ªï½ŠÎšÎºĞšá¦á›•â„ªï¼«ï½‹ÊŸÎ¹Ø§áâ…¬â…¼ï¼¬ï½ŒÎœÏºĞœá·á›–â…¯â…¿ï¼­ï½É´Îï¼®ï½ÎŸÎ¿ĞĞ¾Õ•ğ’†ï¼¯ï½ÎŸÎ¿ĞĞ¾Õ•ğ’†ï¼¯ï½Î¡ÏĞ Ñ€á¢ï¼°ï½á‚­á‚³ï¼±ï½‘Ê€Ô»á’áš±ï¼²ï½’Ğ…Ñ•Õá‚½ášğ’–ï¼³ï½“Î¤Ï„Ğ¢á¢ï¼´ï½”Î¼Ï…Ô±Õâ‹ƒï¼µï½•Î½Ñ´Ñµá™â…¤â…´ï¼¶ï½–Ñ¡á³ï¼·ï½—Î§Ï‡Ğ¥Ñ…â…©â…¹ï¼¸ï½˜ÊÎ¥Î³ÑƒÒ®ï¼¹ï½™Î–áƒï¼ºï½šï½›Ç€Ø§ï½œï½â“ï½Ó§Ó’Ó¦`
	glyph := map[rune][]string{
		'1': {"ï¼‘"},
		'2': {"ï¼’"},
		'3': {"ï¼“"},
		'4': {"ï¼”"},
		'5': {"ï¼•"},
		'6': {"ï¼–"},
		'7': {"ğ’‡", "ï¼—"},
		'8': {"Õ‘", "&", "ï¼˜"},
		'9': {"ï¼™"},
		'0': {"ÎŸ", "Î¿", "Ğ", "Ğ¾", "Õ•", "ğ’†", "ï¼¯", "ï½", "ÎŸ", "Î¿", "Ğ", "Ğ¾", "Õ•", "ğ’†", "ï¼¯", "ï½"},
		'a': {"Ã ", "Ã¡", "Ã¢", "Ã£", "Ã¤", "Ã¥", "Ğ°", "É‘", "Î±", "Ğ°", "ï½"},
		'A': {"Ã€", "Ã", "Ã‚", "Ãƒ", "Ã„", "Ã…", "áª", "ï¼¡"},
		'b': {"d", "lb", "ib", "Ê™", "Ğ¬", "ï½‚", "ÃŸ"},
		'B': {"ÃŸ", "Î’", "Î²", "Ğ’", "Ğ¬", "á´", "á›’", "ï¼¢"},
		'c': {"Ï²", "Ñ", "â…½"},
		'C': {"Ï¹", "Ğ¡", "Ñ", "áŸ", "â…­", "â…½", "ğ’¨", "ï¼£"},
		'd': {"b", "cl", "dl", "di", "Ô", "Õª", "â…¾", "ï½„"},
		'D': {"á ", "â…®", "ï¼¤"},
		'e': {"Ã©", "Ãª", "Ã«", "Ä“", "Ä•", "Ä—", "ï½…", "Ğµ"},
		'E': {"Ãˆ", "Ã‰", "ÃŠ", "Ã‹", "Ä’", "Ä”", "Ä–", "Ä˜", "Äš", "Î•", "Ğ•", "á¬", "ï¼¥"},
		'f': {"ï½†"},
		'F': {"Ïœ", "ï¼¦"},
		'g': {"q", "É¡", "ÔŒ", "ï½‡", "Õ¶"},
		'G': {"á€", "ï¼§", "ÔŒ", "É¢"},
		'h': {"lh", "ih", "Ò»", "ï½ˆ"},
		'i': {"j", "Ñ˜", "ï½Š", "1", "l", "á¥", "â…°", "ï½‰", "É©", "Ñ–", "Ø§á¥", "ğ’ƒ"},
		'I': {"Î™", "Ğ†", "á›", "â… ", "ï¼©"},
		'j': {"j", "Ñ˜", "ï½Š", "1", "l", "á¥", "â…°", "ï½‰", "Ï³", "Õµ"},
		'J': {"Ğˆ", "Ñ˜", "á«", "ï¼ª"},
		'k': {"lk", "ik", "lc", "Îº", "ï½‹", "Îº"},
		'K': {"Ğš", "á¦", "á›•", "â„ª", "ï¼«"},
		'l': {"1", "i", "â…¼", "ï½Œ", "Ó", "ï¼©", "Î¹", "â…¼", "ï½Œ"},
		'L': {"ÊŸ", "Ø§á", "â…¬", "ï¼¬"},
		'm': {"n", "nn", "rn", "rr", "â…¿", "ï½"},
		'M': {"Îœ", "Ïº", "Ğœ", "á·", "á›–", "â…¯", "ï¼­"},
		'n': {"m", "r", "ï½", "É´"},
		'N': {"É´", "Î", "ï¼®"},
		'o': {"0", "ÎŸ", "Î¿", "Ğ", "Ğ¾", "Õ•", "ğ’†", "ï¼¯", "ï½", "ÎŸ", "Î¿", "Ğ", "Ğ¾", "Õ•", "ğ’†", "ï¼¯", "ï½"},
		'O': {"0", "ÎŸ", "Î¿", "Ğ", "Ğ¾", "Õ•", "ğ’†", "ï¼¯", "ï½", "ÎŸ", "Î¿", "Ğ", "Ğ¾", "Õ•", "ğ’†", "ï¼¯", "ï½"},
		'p': {"Ï", "Ñ€", "ï½", "Ñ€"},
		'P': {"Î¡", "Ğ ", "á¢", "ï¼°"},
		'q': {"g", "ï½‘"},
		'Q': {"O", "á‚­", "á‚³", "ï¼±"},
		'r': {"Ê€", "ï½’", "Ô»"},
		'R': {"Ê€", "á’", "áš±", "ï¼²"},
		's': {"Ñ•", "ï½“"},
		'S': {"Ğ…", "Õ", "á‚½", "áš", "ğ’–", "ï¼³"},
		't': {"Ï„", "ï½”"},
		'T': {"Î¤", "Ğ¢", "á¢", "ï¼´"},
		'u': {"Î¼", "Ï…", "Õ", "ï¼µ", "ï½•", "Î½"},
		'U': {"Ô±", "Õ", "ï¼µ"},
		'v': {"ï½–", "Ñµ", "â…´", "Î½"},
		'V': {"Ñ´", "Ñµ", "á™", "â…¤", "ï¼¶"},
		'w': {"vv", "Ñ¡", "ï½—", "Ñ¡"},
		'W': {"á³", "ï¼·"},
		'x': {"â…¹", "ï½˜", "Ñ…"},
		'X': {"Î§", "Ï‡", "Ğ¥", "â…©", "ï¼¸"},
		'y': {"Ê", "Ñƒ", "ï½™"},
		'Y': {"Î¥", "Î³", "Ò®", "ï¼¹"},
		'z': {"ï½š"},
		'Z': {"Î–", "áƒ", "ï¼º"},
	}

	dom := []rune(domain)

	for ws := range dom {
		for i := 0; i < (len(dom) - ws); i++ {
			win := dom[i : i+ws]

			j := 0
			for j < ws {
				c := rune(win[j])
				if repList, ok := glyph[c]; ok {
					for _, rep := range repList {
						g := []rune(rep)

						win = []rune(fmt.Sprintf("%s%s%s", string(win[:j]), string(g), string(win[j+1:])))
						if len(g) > 1 {
							j++
						}
						fuzzed := fmt.Sprintf("%s%s%s", string(dom[:i]), string(win), string(dom[i+ws:]))
						fuzzed = combineTLD(fuzzed, tld)
						res = append(res, fuzzed)
					}
				}
				j++
			}
		}
	}

	return helpers.Dedup(res), nil
}

func (s *homoglyphStrategy) GetName() string {
	return "Homoglyph"
}

func init() {
	Homoglyph = &homoglyphStrategy{}
}
